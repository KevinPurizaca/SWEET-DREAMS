"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[632],{632:(P,c,n)=>{n.r(c),n.d(c,{ShedulesComunitysModule:()=>z});var u=n(1368),h=n(332),f=n(868),_=n(4548),E=n(4704),m=n(2024),p=n(2884),y=n(6876),v=n(1012),C=n(5732),e=n(2116),G=n(1792),b=n(5352),g=n(7564),d=n(4716),T=n(8090),S=n(5592),A=n(232),Y=n(2392),$=n(6304),I=n(3536);function R(i,o){if(1&i){const t=e.KQA();e.I0R(0,"div",19)(1,"div",20)(2,"button",21),e.qCj("click",function(){e.usT(t);const a=e.GaO(2);return e.CGJ(a.saveShedule())}),e.C$Y()()()}}function M(i,o){if(1&i){const t=e.KQA();e.I0R(0,"div",10)(1,"form",11)(2,"div",12)(3,"div",13)(4,"label",14),e.OEk(5,"Dia De la Semana"),e.C$Y(),e.I0R(6,"p-dropdown",15),e.qCj("onChange",function(){e.usT(t);const a=e.GaO();return e.CGJ(a.loadDataHourStream())}),e.C$Y()(),e.I0R(7,"div",13)(8,"label",14),e.OEk(9,"Hora de Stream"),e.C$Y(),e.wR5(10,"p-dropdown",16),e.C$Y(),e.I0R(11,"div",13)(12,"label",14),e.OEk(13,"Tipo de Stream"),e.C$Y(),e.wR5(14,"p-dropdown",17),e.C$Y()(),e.yuY(15,R,3,0,"div",18),e.C$Y()()}if(2&i){const t=e.GaO();e.yG2(),e.E7m("formGroup",t.formAgenda),e.yG2(5),e.E7m("placeholder",t.vMessageSelect)("filter",!0)("emptyMessage",t.vMessageEmpty)("options",t.lstDiaAgenda),e.yG2(4),e.E7m("placeholder",t.vMessageSelect)("options",t.lstHourStream),e.yG2(4),e.E7m("placeholder",t.vMessageSelect)("emptyMessage",t.vMessageEmpty)("options",t.lstTypeSream),e.yG2(),e.E7m("ngIf",t.sheduleAvailable)}}function O(i,o){if(1&i&&(e.I0R(0,"tr")(1,"th",22),e.OEk(2),e.C$Y(),e.I0R(3,"th",23),e.OEk(4,"Lunes"),e.C$Y(),e.I0R(5,"th",23),e.OEk(6,"Martes"),e.C$Y(),e.I0R(7,"th",23),e.OEk(8,"Miercoles"),e.C$Y(),e.I0R(9,"th",23),e.OEk(10,"Jueves"),e.C$Y(),e.I0R(11,"th",23),e.OEk(12,"Viernes"),e.C$Y(),e.I0R(13,"th",23),e.OEk(14,"Sabado"),e.C$Y()()),2&i){const t=e.GaO();e.yG2(2),e.oRS("Hora ",t.lsUser.vtime_zone_user,"")}}function k(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function w(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function F(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function H(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function N(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function x(i,o){if(1&i&&(e.I0R(0,"div")(1,"span",26),e.OEk(2),e.C$Y(),e.wR5(3,"br"),e.C$Y()),2&i){const t=o.$implicit;e.yG2(),e.E7m("ngClass",2==t.itype_stream?"td-stream-vip":""),e.yG2(),e.cNF(t.vname_channel)}}function U(i,o){if(1&i&&(e.I0R(0,"tr")(1,"td",22)(2,"span",24),e.OEk(3),e.C$Y()(),e.I0R(4,"td",23),e.yuY(5,k,4,2,"div",25),e.C$Y(),e.I0R(6,"td",23),e.yuY(7,w,4,2,"div",25),e.C$Y(),e.I0R(8,"td",23),e.yuY(9,F,4,2,"div",25),e.C$Y(),e.I0R(10,"td",23),e.yuY(11,H,4,2,"div",25),e.C$Y(),e.I0R(12,"td",23),e.yuY(13,N,4,2,"div",25),e.C$Y(),e.I0R(14,"td",23),e.yuY(15,x,4,2,"div",25),e.C$Y()()),2&i){const t=o.$implicit;e.yG2(3),e.cNF(t.vzone_time_user),e.yG2(2),e.E7m("ngForOf",t.vday_monday),e.yG2(2),e.E7m("ngForOf",t.vday_tuesday),e.yG2(2),e.E7m("ngForOf",t.vday_wednesday),e.yG2(2),e.E7m("ngForOf",t.vday_thursday),e.yG2(2),e.E7m("ngForOf",t.vday_friday),e.yG2(2),e.E7m("ngForOf",t.vday_saturday)}}function L(i,o){1&i&&(e.I0R(0,"tr")(1,"td",27),e.OEk(2,"No se encontr\xf3 Informaci\xf3n."),e.C$Y()())}function W(i,o){1&i&&(e.I0R(0,"tr")(1,"td",27),e.OEk(2," Cargando informaci\xf3n. Espere por favor. "),e.C$Y()())}let j=(()=>{class i{constructor(t,s,a,l,r,B,J){this.route=t,this.router=s,this.httpCoreService=a,this.commonService=l,this.confirmationService=r,this.utilService=B,this.nameComunity="",this.lsComunity={},this.lsUser={},this.lstShedule=[],this.positionDay=1,this.vMessageEmpty=p.CM,this.vMessageSelect=p.y6,this.lstDiaAgenda=[],this.lstHourStream=[],this.lstTypeSream=[],this.lstMonth=[],this.paramTDTypeSream=y.eE.TYPE_STREAM,this.paramTDMonth=y.eE.MESES_ANIO,this.descriptionSemana="",this.numberSemana=0,this.vactive_agenda=!1,this.sheduleAvailable=!1,this.formAgenda=J.group({intDay:[-1],intHour:[-1],intTypeStream:[-1]})}ngOnInit(){this.route.params.subscribe(t=>{this.nameComunity=t.name,this.loadDataComunity(),this.lsUser=this.utilService.getItemStorage("userdata"),this.loadDataMonth(),this.loadDataTypeStream(),this.fechaActual=new Date,this.currentWeek=this.getWeekNumber(this.fechaActual,0),this.obtenerDiaYHora(0),function D(i=0,o=f.M){return i<0&&(i=0),(0,_.k)(i,i,o)}(1e3).pipe((0,E.k)(()=>(new Date).toLocaleTimeString("en-US",{hour12:!1}))).subscribe(a=>{this.horaActual=a,this.vactive_agenda=this.validarAperturaAgenda(a)})})}loadDataShedule(){this.httpCoreService.post({iid_week_shedule_weekly:this.currentWeek,iid_comunity:this.lsComunity.iid_comunity},m.U.GetListSheduleByWeek).subscribe(s=>{s.isSuccess&&(this.lstShedule=s.data,this.sheduleAvailable=s.sheduleAvailable,this.lstTypeSream=s.normalAvailable?this.lstTypeSream:this.lstTypeSream.filter(a=>1!=a.id),this.lstTypeSream=s.vipAvailable?this.lstTypeSream:this.lstTypeSream.filter(a=>2!=a.id))})}loadDataComunity(){const t=this.router.url.split("/"),s=[t[1],"/",t[2],"/",this.nameComunity].join("");let l={iid_comunity:this.utilService.getOptionGroupComunity(s).iid_comunity,vname_comunity:"",vdescription_comunity:"",istate_record:-1,iindex:0,ilimit:1e3};this.httpCoreService.post(l,m.U.GetListComunity).subscribe(r=>{r.isSuccess&&(this.lsComunity=r.data[0],this.loadDataShedule(),this.loadDataDiaAgenda())})}saveShedule(){let t=this.formAgenda.value,s={iid_shedule_weekly:0,vname_shedule_weekly:"Semana Nro. "+this.numberSemana,vdescription_shedule_weekly:this.descriptionSemana,iid_day_shedule_weekly:t.intDay,vhour_shedule_weekly:t.intHour.substring(0,5),itype_stream:t.intTypeStream,iid_week_shedule_weekly:this.numberSemana,iid_user:this.lsUser.iid_user,iid_comunity:this.lsComunity.iid_comunity,istate_record:1};this.httpCoreService.post(s,m.U.RegisterShedule).subscribe(a=>{console.log("res:",a),a.isSuccess?(this.loadDataDiaAgenda(),this.loadDataShedule(),this.lstHourStream=[],this.formAgenda.reset(),this.commonService.HanddleInfoMessage(p.gv.MSG_AGENDA_REGISTRADA)):this.commonService.HanddleErrorMessage(a)})}loadDataDiaAgenda(){this.httpCoreService.post({iid_week_shedule_weekly:this.currentWeek,iid_comunity:this.lsComunity.iid_comunity},m.U.GetListDayAvailableByWeek).subscribe(s=>{s.isSuccess&&(this.lstDiaAgenda=s.data)})}loadDataTypeStream(){this.httpCoreService.get(m.U.GetListTableDetailCB+this.paramTDTypeSream).subscribe(t=>{t.isSuccess&&(this.lstTypeSream=0!=this.lsUser.ihours_vip_range_user&&0!=this.lsUser.ihours_normal_range_user?t.data:t.data.filter(0==this.lsUser.ihours_normal_range_user?s=>1!=s.id:s=>2!=s.id))})}loadDataHourStream(){let s={iid_week_shedule_weekly:this.currentWeek,iid_comunity:this.lsComunity.iid_comunity,iid_day_shedule_weekly:this.formAgenda.value.intDay};this.lstHourStream=[],this.httpCoreService.post(s,m.U.GetListHourAvailableByDay).subscribe(a=>{a.isSuccess&&(this.lstHourStream=a.data)})}validarAperturaAgenda(t){const s=t.split(":"),a=this.lsUser.vtime_agenda_range_user.split(":");return s[0]>=a[0]&&s[1]>=a[1]}getWeekNumber(t,s){const a=new Date(t);a.setDate(a.getDate()+s),a.setHours(0,0,0,0),a.setDate(a.getDate()+4-(a.getDay()||7));const l=new Date(a.getFullYear(),0,1),r=Math.ceil(((a-l)/864e5+1)/7);return this.numberSemana=r+(0===a.getDay()?1:0),this.numberSemana}obtenerDiaYHora(t){const l=(new Date).getDate()+t,r=["Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado","Domingo"][(l-1)%7];return this.positionDay=l%7-1,this.descriptionSemana=`${r}  ${l} de [mes] de la Semana Nro. ${this.numberSemana}`,`Hoy es ${r} ${l}  posicion ${this.positionDay} del array`}loadDataMonth(){this.httpCoreService.get(m.U.GetListTableDetailCB+this.paramTDMonth).subscribe(t=>{if(t.isSuccess){this.lstMonth=t.data;let s=this.lstMonth.find(a=>a.id==(new Date).getMonth()+1).vvalue1;this.descriptionSemana=this.descriptionSemana.replace("[mes]",s)}})}static#e=this.\u0275fac=function(s){return new(s||i)(e.GI1(h.gV),e.GI1(h.E5),e.GI1(G.c),e.GI1(b.G),e.GI1(g.EV),e.GI1(v.e),e.GI1(d.im))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["app-shedules-comunitys"]],standalone:!0,features:[e.M5G([v.e]),e.UHJ],decls:13,vars:8,consts:[["key","tst",3,"baseZIndex"],["key","deleteDetalle"],[3,"header"],["class","",4,"ngIf"],["header","MI AGENDA SEMANAL"],["dataKey","id","styleClass","p-datatable-gridlines","responsiveLayout","scroll",1,"m-1",3,"value","rows","rowHover","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","loadingbody"],[1,""],[3,"formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"col-12","md:col-3"],[1,"label-filter-text"],["formControlName","intDay","optionLabel","vvalue1","optionValue","id","appendTo","body",3,"placeholder","filter","emptyMessage","options","onChange"],["formControlName","intHour","optionLabel","vvalue1","optionValue","vvalue3","appendTo","body","emptyMessage","Seleccione Dia de la Semana",3,"placeholder","options"],["formControlName","intTypeStream","optionLabel","vvalue1","optionValue","id","appendTo","body",3,"placeholder","emptyMessage","options"],["class","flex flex-wrap sm:flex-row",4,"ngIf"],[1,"flex","flex-wrap","sm:flex-row"],[1,"sm:mr-auto","mb-3","mr-3"],["pButton","","label","Agregar Horario","type","button","icon","pi pi-plus",1,"p-button-help",3,"click"],["pFrozenColumn","",1,"td-zone-time"],[1,"td-day-week"],[1,"flex","justify-content-center","font-bold","text-3xl"],[4,"ngFor","ngForOf"],[3,"ngClass"],["colspan","7"]],template:function(s,a){1&s&&(e.wR5(0,"p-toast",0)(1,"p-confirmPopup",1),e.I0R(2,"p-panel",2)(3,"h1"),e.OEk(4),e.C$Y(),e.yuY(5,M,16,11,"div",3),e.C$Y(),e.wR5(6,"br"),e.I0R(7,"p-panel",4)(8,"p-table",5),e.yuY(9,O,15,1,"ng-template",6)(10,U,16,7,"ng-template",7)(11,L,3,0,"ng-template",8)(12,W,3,0,"ng-template",9),e.C$Y()()),2&s&&(e.E7m("baseZIndex",99999),e.yG2(2),e.E7m("header","AGENDA SEMANAL  "+a.lsComunity.vname_comunity),e.yG2(2),e.oRS("HORA ACTUAL: ",a.horaActual,""),e.yG2(),e.E7m("ngIf",a.vactive_agenda),e.yG2(3),e.E7m("value",a.lstShedule)("rows",5)("rowHover",!0)("scrollable",!0))},dependencies:[C.k,u.QF,u.ay,u.u_,d.sz,d.ue,d.u,d.uW,d.Wo,T.cS,g.U3,S.oJ,S._E,A.A9,Y.s,$.qA,I.W],styles:[".td-zone-time[_ngcontent-%COMP%]{min-width:9rem;max-width:9rem}.td-day-week[_ngcontent-%COMP%]{min-width:12rem;max-width:12rem;font-weight:700}.td-stream-vip[_ngcontent-%COMP%]{color:red}"]})}return i})(),V=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.a4G({type:i});static#i=this.\u0275inj=e.s3X({imports:[h.qQ.forChild([{path:"",component:j}]),h.qQ]})}return i})(),z=(()=>{class i{static#e=this.\u0275fac=function(s){return new(s||i)};static#t=this.\u0275mod=e.a4G({type:i});static#i=this.\u0275inj=e.s3X({imports:[u.MD,C.k,V]})}return i})()}}]);